<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Audit Active Directory quick and dirty. Find all administrators, disabled users and lastlogin (UTC) | Cortana Design</title>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
    integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/b681124c99.js" crossorigin="anonymous"></script>
  <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon" />
  <link href="/assets/css/main.css" rel="stylesheet" />
  <link href="/assets/css/rouge-github.css" rel="stylesheet" />
  <link href="/assets/css/custom.css" rel="stylesheet" />

  <link rel="alternate" type="application/atom+xml" title="Cortana Design" href="/feed.xml" />

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Audit Active Directory quick and dirty. Find all administrators, disabled users and lastlogin (UTC) | Cortana Design</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Audit Active Directory quick and dirty. Find all administrators, disabled users and lastlogin (UTC)" />
<meta name="author" content="Trent Steenholdt" />
<meta property="og:locale" content="en_AU" />
<meta name="description" content="I had the need today to do a quick audit of Active Directory and see where it was at for a client. Not just the norm like dcdiag.exe, repadmin and checking the Event Viewer to see if there were any issues but also how many administrators there are, who is disabled (if any as I had my doubts) and the last last login for each user. PowerShell to the rescue." />
<meta property="og:description" content="I had the need today to do a quick audit of Active Directory and see where it was at for a client. Not just the norm like dcdiag.exe, repadmin and checking the Event Viewer to see if there were any issues but also how many administrators there are, who is disabled (if any as I had my doubts) and the last last login for each user. PowerShell to the rescue." />
<link rel="canonical" href="http://localhost:4000/2014/02/21/audit-active-directory-quick-and-dirty-find-all-administrators-disabled-users-and-lastlogin-utc" />
<meta property="og:url" content="http://localhost:4000/2014/02/21/audit-active-directory-quick-and-dirty-find-all-administrators-disabled-users-and-lastlogin-utc" />
<meta property="og:site_name" content="Cortana Design" />
<meta property="og:image" content="http://localhost:4000/assets/images/default-card.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-02-21T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/default-card.png" />
<meta property="twitter:title" content="Audit Active Directory quick and dirty. Find all administrators, disabled users and lastlogin (UTC)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Trent Steenholdt"},"dateModified":"2014-02-21T00:00:00+08:00","datePublished":"2014-02-21T00:00:00+08:00","description":"I had the need today to do a quick audit of Active Directory and see where it was at for a client. Not just the norm like dcdiag.exe, repadmin and checking the Event Viewer to see if there were any issues but also how many administrators there are, who is disabled (if any as I had my doubts) and the last last login for each user. PowerShell to the rescue.","headline":"Audit Active Directory quick and dirty. Find all administrators, disabled users and lastlogin (UTC)","image":"http://localhost:4000/assets/images/default-card.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2014/02/21/audit-active-directory-quick-and-dirty-find-all-administrators-disabled-users-and-lastlogin-utc"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/CortanaDesign-logo.svg"},"name":"Trent Steenholdt"},"url":"http://localhost:4000/2014/02/21/audit-active-directory-quick-and-dirty-find-all-administrators-disabled-users-and-lastlogin-utc"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body class="d-flex flex-column min-vh-100 bg-light">

  <header>
  <div class="container-fluid text-center">
    <!-- Logo Row -->
    <div class="row mb-3 mt-3">
      <a href="/" title="Cortana Design">
        <img src="/assets/images/cortanadesign.png" alt="Cortana Design Logo" class="img-fluid"
          style="max-height: 155px;">
      </a>
    </div>

    <!-- Buttons Row -->
    <div class="row mb-5">
      <div class="d-flex justify-content-center gap-3">
        <a class="btn btn-dark btn-rounded" href="https://twitter.com/CortannDesign" target="_blank"
          rel="noopener noreferrer" title="Cortana Design on Twitter">
          <i class="fa-brands fa-x-twitter"></i>
          <span class="sr-only">Twitter</span>
        </a>
        <a class="btn btn-linkedin btn-rounded" href="https://www.linkedin.com/company/CortanaDesign/" target="_blank"
          rel="noopener noreferrer" title="Cortana Design on LinkedIn">
          <i class="fa-brands fa-linkedin-in"></i>
          <span class="sr-only">LinkedIn</span>
        </a>
        <a class="btn btn-rss btn-rounded" href="/feed.xml" target="_blank" title="RSS">
          <i class="fa-solid fa-rss"></i>
          <span class="sr-only">RSS</span>
        </a>
        <a class="btn btn-cortana-dark btn-rounded" href="/search" title="Search">
          <i class="fa-solid fa-magnifying-glass"></i>
          <span class="sr-only">Search</span>
        </a>
      </div>
    </div>

    <!-- Blog Title/Description Row -->
    <div class="row mb-2 justify-content-center">
      <div class="col-12 col-md-8 col-lg-6 mx-auto"></div>
      <h3 class="text-center">Trent Steenholdt's Blog</h3>
      <p class="text-center" style="max-width: 550px;">
        A simple blog sharing my findings, interests, and work in the Information Technology industry, as well as
        anything else that interests me.
      </p>
    </div>
  </div>
  </div>
  </div>
</header> <nav class="container-fluid mt-3 d-flex justify-content-center">
  <div class="btn-group" role="group" aria-label="Navigation">
    <a href="/" class="btn btn-cortana-dark btn-lg px-4">Home</a>
    <a href="/author/trentsteenholdt/" class="btn btn-cortana-dark btn-lg px-4">About Me</a>
    <a href="/tags" class="btn btn-cortana-dark btn-lg px-4">Tags</a>
    <a href="https://www.cortanadesign.com.au" class="btn btn-cortana-dark btn-lg px-4">Cortana Design</a>
  </div>
</nav>
  <main><div class="container">
  <article>
    <h1>Audit Active Directory quick and dirty. Find all administrators, disabled users and lastlogin (UTC)</h1>
    <p class="publish-date">
  
  

  <!-- Profile Image -->
  
  
  
  
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
  
<p>
  <img class="img-profile-small" src="/assets/images/profile/trentsteenholdt.jpeg" alt="trentsteenholdt" />
  <a rel="author" href="/author/trentsteenholdt" title="Trent Steenholdt">
    Trent Steenholdt
  </a>
  <br />
  February 21, 2014
  
</p>



<!-- No Profile Image -->

<p class="bio">
  
  
  1 minutes to read
  
</p>
</p>
    <div class="tag-container"><span class="tags">Tags: </span><a class="badge bg-CortanaDesign-blue-dark" href="/tags/#active-directory">active-directory</a><a class="badge bg-CortanaDesign-blue-dark" href="/tags/#ad">ad</a><a class="badge bg-CortanaDesign-blue-dark" href="/tags/#audit">audit</a></div>
    <p>I had the need today to do a quick audit of Active Directory and see where it was at for a client. Not just the norm like <strong>dcdiag.exe, repadmin</strong> and checking the Event Viewer to see if there were any issues but also how many administrators there are, who is disabled (if any as I had my doubts) and the last last login for each user. PowerShell to the rescue.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">((</span>Get-Module <span class="nt">-Name</span> ActiveDirectory<span class="o">)</span> <span class="nt">-eq</span> <span class="nv">$nul</span><span class="o">)</span> <span class="o">{</span> Import-Module ActiveDirectory <span class="o">}</span>

<span class="nv">$admins</span> <span class="o">=</span> Get-ADGroupMember <span class="nt">-Identity</span> <span class="s2">"Administrators"</span> <span class="nt">-Recursive</span>
<span class="nv">$admins</span> +<span class="o">=</span> Get-ADGroupMember <span class="nt">-Identity</span> <span class="s2">"Domain Admins"</span> <span class="nt">-Recursive</span>
<span class="nv">$admins</span> +<span class="o">=</span> Get-ADGroupMember <span class="nt">-Identity</span> <span class="s2">"Enterprise Admins"</span> <span class="nt">-Recursive</span>

Write-Host <span class="s2">"Administrative accounts"</span> <span class="nt">-ForegroundColor</span> Green
foreach <span class="o">(</span><span class="nv">$admin</span> <span class="k">in</span> <span class="o">(</span><span class="nv">$admins</span> | Sort-Object <span class="nt">-Property</span> sAMAccountName <span class="nt">-Unique</span><span class="o">))</span> <span class="o">{</span> <span class="k">if</span> <span class="o">(</span><span class="nv">$admin</span>.objectClass <span class="nt">-eq</span> <span class="s2">"user"</span><span class="o">)</span> <span class="o">{</span>Write-Host <span class="nv">$admin</span>.sAMAccountName<span class="o">}</span> <span class="o">}</span>

Write-Host <span class="s2">"Disabled users"</span> <span class="nt">-ForegroundColor</span> Green
foreach <span class="o">(</span><span class="nv">$user</span> <span class="k">in</span> <span class="o">(</span>Get-ADUser <span class="nt">-Filter</span> <span class="o">{</span>Enabled <span class="nt">-eq</span> <span class="nv">$false</span><span class="o">}</span> | Sort-Object <span class="nt">-Property</span> sAMAccountName<span class="o">))</span> <span class="o">{</span> Write-Host <span class="nv">$user</span>.sAMAccountName <span class="o">}</span>

<span class="c"># I'd STRONGLY recommend using the -SearchBase parameter to reduce query load if at all possible</span>
Write-Host <span class="s2">"Last logon times (UTC)"</span> <span class="nt">-ForegroundColor</span> Green
foreach <span class="o">(</span><span class="nv">$user</span> <span class="k">in</span> <span class="o">(</span>Get-ADUser <span class="nt">-Filter</span> <span class="k">*</span> <span class="nt">-Property</span> lastLogonTimestamp | Sort-Object <span class="nt">-Property</span> sAMAccountName<span class="o">))</span> <span class="o">{</span> <span class="k">if</span> <span class="o">(</span><span class="nv">$user</span>.lastLogonTimestamp <span class="nt">-eq</span> <span class="nv">$null</span><span class="o">)</span> <span class="o">{</span><span class="nv">$dt</span> <span class="o">=</span> <span class="s1">''</span><span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="nv">$dt</span> <span class="o">=</span> <span class="o">[</span>datetime]<span class="nv">$user</span>.lastLogonTimestamp <span class="o">}</span><span class="p">;</span> Write-Output<span class="o">(</span><span class="nv">$user</span>.sAMAccountName +<span class="s2">","</span>+ <span class="nv">$dt</span><span class="o">)</span> | Write-Host <span class="o">}</span>

</code></pre></div></div>

    <div class="social-share">
  <a href="https://twitter.com/intent/tweet?text=Audit Active Directory quick and dirty. Find all administrators, disabled users and lastlogin (UTC)&amp;url=http://localhost:4000/2014/02/21/audit-active-directory-quick-and-dirty-find-all-administrators-disabled-users-and-lastlogin-utc&amp;via=CortanaDesigntechapac"
    class="btn btn-twitter mb-1">
    <i class="fa-brands fa-x-twitter me-1"></i>Share on Twitter (X)
  </a>
  <a href=" https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/2014/02/21/audit-active-directory-quick-and-dirty-find-all-administrators-disabled-users-and-lastlogin-utc"
    class="btn btn-linkedin mb-1">
    <i class="fa-brands fa-linkedin-in me-1"></i>Share on LinkedIn
  </a>
  <a href="/feed.xml" class="btn btn-rss mb-1">
    <i class="fa-solid fa-rss me-1"></i>RSS Feed
  </a>
</div>
  </article>
</div></main>
  <footer class="footer mt-auto py-3">
  <div class="row">
    <div class="col">
      <p class="small mb-0">© 2025 Cortana Design</p>
    </div>
    <div class="col">
      <ul class="list-inline mb-0">
        <li class="list-inline-item mx-3">
          <a class="small text-white" href="https://www.cortanadesign.com.au">Cortana Design</a>
        </li>
        <li class="list-inline-item mx-3">
          <a class="small text-white" href="https://lainrobertson.wordpress.com/">Lain Robertson's
            Blog</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

  <script src="/assets/js/main.js"></script>
</body>

</html>